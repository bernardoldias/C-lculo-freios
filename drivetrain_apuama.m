clear;
clc;
close all;

rpm2 = linspace(0, 12086, 382); %gerando um vetor rpm de 0 a 12227.8 com 383 colunas
rpm = [4026.63	4028.94	4035.88	4040.5	4052.06	4061.31	4065.93	4079.8	4093.67	4107.54	4116.78	4132.96	4146.83	4160.7	4179.19	4195.37	4218.49	4239.29	4255.47	4278.59	4304.01	4327.13	4357.18	4387.23	4414.97	4442.7	4465.82	4486.62	4512.05	4535.16	4555.97	4574.46	4592.95	4613.75	4634.56	4650.74	4669.23	4687.72	4708.53	4727.02	4743.2	4759.38	4777.87	4791.74	4805.61	4824.1	4844.9	4863.4	4881.89	4898.07	4916.56	4935.05	4955.86	4976.66	4995.15	5011.33	5032.14	5050.63	5073.74	5103.79	5126.91	5152.33	5173.14	5203.19	5233.24	5263.29	5295.65	5325.7	5360.37	5395.04	5429.71	5455.14	5485.19	5512.93	5542.98	5570.72	5593.83	5623.88	5653.93	5674.73	5702.47	5727.9	5751.01	5774.13	5794.93	5815.73	5836.54	5859.65	5880.46	5901.26	5919.75	5938.24	5961.36	5984.47	6000.65	6023.77	6042.26	6060.75	6079.24	6097.74	6118.54	6139.34	6157.84	6178.64	6201.75	6215.62	6236.43	6254.92	6275.72	6291.9	6312.71	6340.44	6363.56	6386.67	6416.72	6449.09	6479.13	6506.87	6534.61	6566.97	6601.64	6634.01	6664.05	6691.79	6724.15	6754.2	6788.88	6816.61	6844.35	6874.4	6902.14	6929.88	6950.68	6971.48	6989.98	7010.78	7026.96	7045.45	7066.26	7084.75	7103.24	7119.42	7135.6	7154.09	7170.27	7191.08	7209.57	7230.37	7246.55	7262.73	7285.85	7299.72	7318.21	7334.39	7355.19	7376	7396.8	7415.29	7433.78	7449.96	7461.52	7484.64	7510.06	7533.18	7551.67	7570.16	7588.65	7607.15	7625.64	7646.44	7667.25	7685.74	7706.54	7734.28	7752.77	7773.57	7792.07	7817.49	7842.92	7863.72	7889.15	7907.64	7930.76	7958.49	7981.61	8007.04	8037.09	8064.82	8092.56	8120.3	8145.73	8175.78	8201.2	8231.25	8256.68	8282.1	8312.15	8337.58	8365.32	8393.06	8416.17	8439.29	8464.71	8492.45	8517.88	8543.3	8564.11	8584.91	8605.71	8626.52	8647.32	8665.81	8688.93	8707.42	8728.22	8746.72	8762.9	8772.14	8790.63	8811.44	8832.24	8853.05	8871.54	8892.34	8913.14	8938.57	8954.75	8975.55	8996.36	9017.16	9035.65	9058.77	9079.57	9098.06	9114.24	9135.05	9151.23	9169.72	9192.84	9213.64	9232.13	9248.31	9271.43	9292.23	9308.41	9329.21	9352.33	9373.13	9387	9407.81	9430.92	9449.41	9467.9	9491.02	9514.13	9537.25	9553.43	9578.86	9595.04	9613.53	9636.64	9657.45	9678.25	9699.05	9724.48	9742.97	9763.78	9786.89	9812.32	9835.43	9851.61	9872.42	9895.53	9927.89	9953.32	9974.12	9997.24	10022.7	10045.8	10066.6	10089.7	10112.8	10138.2	10163.7	10189.1	10207.6	10228.4	10253.8	10276.9	10295.4	10311.6	10339.3	10364.8	10387.9	10408.7	10434.1	10457.2	10475.7	10498.8	10519.6	10545.1	10570.5	10586.7	10612.1	10632.9	10649.1	10672.2	10693	10716.1	10736.9	10760	10780.8	10794.7	10810.9	10834	10861.7	10884.9	10905.7	10926.5	10940.3	10963.4	10979.6	11002.7	11023.5	11049	11067.5	11090.6	11113.7	11134.5	11155.3	11176.1	11196.9	11220	11238.5	11261.6	11284.7	11305.5	11328.7	11354.1	11377.2	11393.4	11416.5	11439.6	11458.1	11478.9	11502	11527.5	11548.3	11569.1	11592.2	11613	11636.1	11663.8	11684.6	11703.1	11723.9	11747	11772.5	11800.2	11821	11844.1	11867.2	11888	11908.8	11934.3	11945.8	11964.3	11971.3	11985.1	11999	12008.2	11989.8	12005.9	12024.4	12012.9	12022.1	12040.6	12054.5	12068.3	12075.3	12082.2	12086.8];
torque = [3.93	3.93	3.93	3.93	3.93	3.88	3.88	3.88	3.88	3.83	3.83	3.83	3.78	3.78	3.78	3.78	3.73	3.73	3.73	3.73	3.73	3.73	3.73	3.73	3.78	3.78	3.78	3.83	3.88	3.93	3.93	3.93	3.93	3.93	3.93	3.93	3.93	3.93	3.93	3.93	3.88	3.88	3.88	3.88	3.83	3.83	3.78	3.78	3.73	3.73	3.73	3.68	3.68	3.63	3.63	3.63	3.58	3.58	3.58	3.53	3.53	3.48	3.48	3.48	3.48	3.48	3.53	3.53	3.53	3.58	3.58	3.68	3.73	3.73	3.78	3.83	3.83	3.88	3.88	3.88	3.93	3.93	3.98	3.98	4.02	4.02	4.02	4.02	4.02	4.02	4.02	4.07	4.02	4.02	4.02	4.02	4.02	4.02	4.02	4.02	4.02	4.02	4.02	4.02	3.98	4.02	4.02	3.98	3.98	3.98	3.98	3.98	3.93	3.93	3.93	3.93	3.98	3.98	3.98	4.02	4.07	4.12	4.12	4.17	4.22	4.27	4.32	4.37	4.42	4.42	4.47	4.52	4.57	4.62	4.66	4.66	4.71	4.71	4.71	4.71	4.71	4.71	4.71	4.71	4.71	4.71	4.71	4.66	4.66	4.66	4.71	4.71	4.71	4.66	4.66	4.66	4.66	4.66	4.66	4.66	4.66	4.66	4.62	4.62	4.62	4.62	4.62	4.62	4.62	4.62	4.57	4.57	4.57	4.57	4.52	4.52	4.52	4.52	4.57	4.52	4.52	4.52	4.52	4.52	4.52	4.57	4.57	4.57	4.57	4.57	4.62	4.62	4.66	4.66	4.71	4.71	4.76	4.76	4.76	4.86	4.86	4.86	4.91	4.96	4.96	5.01	5.01	5.01	5.06	5.06	5.11	5.11	5.11	5.11	5.11	5.11	5.11	5.11	5.11	5.11	5.11	5.06	5.06	5.01	5.01	5.01	5.01	5.06	5.06	5.06	5.06	5.06	5.06	5.01	5.06	5.01	5.01	5.01	5.01	5.01	4.96	4.96	4.96	4.96	4.96	4.96	4.91	4.91	4.91	4.91	4.86	4.86	4.86	4.81	4.81	4.81	4.76	4.76	4.76	4.76	4.76	4.76	4.71	4.71	4.71	4.66	4.66	4.66	4.66	4.66	4.66	4.66	4.62	4.62	4.62	4.57	4.57	4.57	4.62	4.62	4.62	4.62	4.62	4.62	4.57	4.57	4.57	4.62	4.57	4.57	4.57	4.57	4.52	4.52	4.52	4.52	4.52	4.52	4.52	4.52	4.52	4.52	4.52	4.47	4.52	4.47	4.47	4.47	4.42	4.42	4.42	4.42	4.42	4.37	4.37	4.37	4.32	4.27	4.27	4.27	4.27	4.27	4.27	4.22	4.17	4.17	4.12	4.12	4.12	4.12	4.07	4.07	4.07	4.07	4.02	4.02	4.02	3.98	3.98	3.93	3.93	3.93	3.93	3.88	3.88	3.88	3.83	3.83	3.83	3.78	3.78	3.78	3.78	3.73	3.73	3.73	3.73	3.73	3.68	3.68	3.63	3.63	3.63	3.63	3.58	3.58	3.58	3.58	3.58	3.58	3.58	3.58	3.58	3.58	3.58	3.53	3.53	3.53	3.53	3.53	3.53	3.53];
pot1 = [22.1	22.1	22.1	22.2	22.2	22	22	22.1	22.2	22	22	22.1	21.9	22	22.1	22.1	22	22.1	22.2	22.3	22.4	22.5	22.7	22.8	23.3	23.4	23.6	24	24.4	24.9	25	25.1	25.2	25.3	25.4	25.5	25.6	25.7	25.8	25.9	25.7	25.8	25.9	26	25.7	25.8	25.6	25.7	25.4	25.5	25.6	25.4	25.5	25.2	25.3	25.4	25.2	25.2	25.4	25.2	25.3	25	25.1	25.3	25.4	25.6	26.1	26.2	26.4	27	27.1	28	28.6	28.7	29.3	29.8	29.9	30.5	30.6	30.7	31.3	31.4	32	32.1	32.5	32.6	32.8	32.9	33	33.1	33.2	33.7	33.5	33.6	33.7	33.8	33.9	34	34.1	34.2	34.3	34.5	34.6	34.7	34.5	34.9	35	34.8	34.9	35	35.1	35.2	34.9	35	35.2	35.4	36	36.2	36.3	36.9	37.5	38.2	38.3	39	39.6	40.3	40.9	41.6	42.2	42.4	43.1	43.7	44.4	45	45.5	45.6	46.2	46.3	46.5	46.6	46.7	46.8	46.9	47	47.2	47.3	47.4	47	47.2	47.3	47.9	48	48.1	47.7	47.9	48	48.1	48.2	48.4	48.5	48.5	48.7	48.4	48.6	48.7	48.8	49	49.1	49.2	49.3	48.9	49	49.2	49.4	48.9	49.1	49.2	49.3	50	49.6	49.8	49.9	50.1	50.2	50.4	51.1	51.3	51.5	51.6	51.8	52.5	52.7	53.4	53.6	54.3	54.5	55.2	55.4	55.6	57	57.1	57.3	58	58.8	59	59.8	59.9	60.1	60.8	60.9	61.7	61.8	62	62.1	62.3	62.4	62.5	62.6	62.7	62.9	63	62.5	62.7	62.2	62.3	62.5	62.6	63.4	63.6	63.7	63.8	64	64.1	63.6	64.4	63.9	64	64.1	64.3	64.5	63.9	64	64.2	64.4	64.5	64.6	64.1	64.3	64.4	64.5	64	64.1	64.2	63.7	63.9	64.1	63.5	63.7	63.8	63.9	64	64.2	63.6	63.8	64	63.4	63.5	63.7	63.8	64	64.1	64.2	63.8	64	64.2	63.6	63.8	64	64.8	64.9	65.1	65.2	65.4	65.6	65	65.1	65.3	66.1	65.6	65.7	65.8	66	65.4	65.6	65.7	65.9	66	66.1	66.3	66.4	66.6	66.7	66.8	66.2	67.1	66.5	66.6	66.7	66.1	66.3	66.4	66.5	66.6	66	66.1	66.3	65.7	65	65.1	65.2	65.4	65.5	65.6	65	64.3	64.4	63.8	63.9	64.1	64.2	63.5	63.6	63.8	63.9	63.2	63.3	63.5	63	63.1	62.4	62.5	62.6	62.8	62.1	62.2	62.3	61.6	61.8	61.9	61.2	61.3	61.4	61.6	60.9	61	61.1	61.2	61.3	60.6	60.7	60	60.1	60.3	60.4	59.7	59.7	59.8	59.8	59.9	60	60	59.9	60	60.1	60	59.3	59.3	59.4	59.5	59.5	59.6	59.6];
pot = 0.85*pot1;
potkw = pot*(0.735499); %potencia do motor[KW]
g = 9.81;% gravidade [m/s²]
perda_torque = 0.85*torque;
torqueNm = perda_torque*g; %torque do motor[Nm]
modulo =[2.8 2.6 2.7 2.15 2.2 2.85]; %modulo dos dentes da engrenagem
primaria = 2.111; %saida do motor e entrada do cambio
modulo_coroa = 5.2; %modulo do dente da coroa
tamanho_coroa = 43; %quantidade de dentes
coroa1 = 3.909; %relação da coroa final
coroa = coroa1*primaria; %relação da coroa final
r = 0.228; %raio da roda [m]
massa = 290; %massa do carro com piloto[Kg]
CD=0.608;    % Drag coeffcient
AreaF=0.8; % Frontal area [m^2]
rho = 1.225; %densidade do ar[Kg/m³]
entradas = [12 16 18 23 24 21]; %define as entradas das engrenangens das marchas
saidas = [33 31 28 31 29 23]; %define as saídas das engrenagens das marchas
rel = saidas./entradas; %relação do cambio da saída pela entrada
dis = ((modulo.*entradas)+(modulo.*saidas))/2; %distância entre os eixos
final = rel*coroa; %relação final
N = rpm2/primaria; %rpm dividido pela relação global(pq ele divide pela primária? não deveria ser a final sem pneu?)
omega = 2*pi*N/60; %velocidade angular da roda (a velocidade angular da roda, não deveria ser a mesma da coroa?)
vel = omega*r; %velocidade do carro[m/s]
vel2 = vel*3.6; %velocidade do carro[Km/h]
alpha = [-10 -5 0 5 10 15]; %angulação da pista
senalpha = sin(alpha*pi/180); %passa pra rad (precisa verificar)
rr = 0.04; %resistência ao rolamento (precisa verficar a resistência ao rolamento (coeficiente))
%% velocidade pra cada marcha
LimT = r*2334*ones(1,382); %função para fazer a reta do limite trativo do pneu (verificar com burno limite trativo)
for m = 1:6
    
    tt = (massa*g*(rr+r*senalpha(m)))+1/2*rho*AreaF*CD*(omega.^2)*(r^3); %%torque resistivo
    v = 2*pi*rpm*r/(60*final(m));%velocidade do carro[m/s]
    v2 = v*3.6; %velocidade do carro[Km/h]
    T1 = torqueNm* rel(m);
    T2 = torqueNm*final(m);
    P1 = pot*final(m);
    
    %% plotar o gráfico de torque na roda e resistivo pela velocidade
    figure(2)
    plot(vel2, tt, 'color', 'black')
    hold on
    plot(v2,LimT, 'color', 'red')
    hold on
    plot(v2,T2)
    hold on
    xlim([15 130])
    ylim([50 1100])
    title('Relação entre o Torque Motor/Velocidade do Veículo e Torque resistente/velocidade do veículo')
    xlabel('Velocidade[Km/h]')
    ylabel('Torque[Nm]')
    legend('Torque Resistivo','Limite Trativo')
       
end
%% ordenamento de marchas
Tmax = 8647*ones(1,382); %rotação do torque máximo
Pmax = 10632*ones(1,382); %rotação da potência máxima
for n = 1:6
    %rpm3 = vel2*final(n)/(0.06*r*2*pi/100);
    ordem = (r*2*pi*0.06*rpm)/final(n); %o que é o 0.06? 
    
    %plota dente de serra
    figure(4);
    plot(ordem,rpm)
    hold on
    plot(ordem, Tmax, 'color', 'black')
    hold on
    plot(ordem, Pmax, 'color', 'red')
    hold on
    line([ordem(305) ordem(305)], [min(4000) max(12000)], 'Color', 'black', 'LineStyle', '--');
    title('Dente de Serra')
    xlabel('Velocidade[Km/h]')
    ylabel('RPM')
end

%% gráficos
% Cria a figura do gráfico torque e potência x rpm
figure(5);
% Plota o gráfico com dois eixos y
yyaxis left
plot(rpm,pot)
ylabel('Potência[Hp]')
yyaxis right
plot(rpm,torqueNm)
ylabel('Torque[Nm]')
% Pereonaliza o gráfico
title('Torque e Potência X RPM')
xlabel('RPM')
legend('Potência','Torque')